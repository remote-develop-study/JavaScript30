<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead 👀</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

const cities = [];

//fetch로 데이터를 받는다
//fetch returns promise
//promise can work with then
//fetch()를 불러들이는 경우, 취득할 리소스를 반드시 인수로 지정하지 않으면 안됩니다. 읽어들인 뒤,  fetch()는 Promise객체를 반환합니다. 

// ... 을 사용하지 않을 시 array 속에 array가 형성된다 (cities도 array, data도 array로 cities에 data array를 통으로 넣음으로써 cities에 첫 번째 배열에 data array가 통으로 들어간다)
// ... 을 사용해서 data가 온전한 배열로 cities에 들어갈 수 있도록 한다
fetch(endpoint)
.then(blob => blob.json())
.then(data => cities.push(...data))

// 가진 배열 중에 서치한 검색어에 매치가 되는 데이터를 반환해 주는 함수
function findMatches(wordToMatch, cities){
  return cities.filter(place => {
    // here we need to figure out if the city on state matches what was searched
    // how do we put a variable in to regular expression
    
    // create a regular expression
    // gi는 정규 표현식의 옵션
    // g : 글로벌의 뜻. 전역 매칭을 한다. 처음부터가 아닌 전체에서 정규식이 맞는걸 찾는다. 
    // i : case Insensitive, 대소문자 구별안함
    const regex = new RegExp(wordToMatch, 'gi');

    //city가 맞든 state가 맞든 둘 중 하나만 맞아도 return 
    return place.city.match(regex) || place.state.match(regex)
  });
}

// population 단위마다 , 찍어주는 함수
function numberWithCommas(x){
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function displayMatches(){
  const matchArray = findMatches(this.value, cities);
  console.log(matchArray);
  const html = matchArray.map(place => {
    //검색한 단어가 시티 이름 중 매치되는 부분에 highlight 되도록 설정
    const regex = new RegExp(this.value, 'gi');
    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);

    const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
    
    return `
      <li>
        <span class="name">${cityName}, ${stateName}</span>  
        <span class="poplution">${numberWithCommas(place.population)}</span>
      </li>
    `;
  }).join('');
  suggestions.innerHTML = html;
}

const searchInput = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');

//change event fires when you go off that input => so that displayMatches event fires when you focus out from input
searchInput.addEventListener('change', displayMatches);
//그렇기 때문에 key가 눌릴 때마다 입력된 문자를 인지하기 위해서 keyup 이벤트에도 displayMatches를 걸어준다
searchInput.addEventListener('keyup', displayMatches);




</script>
</body>
</html>
